version: '2'
services:
  mariadb:
    image: docker.io/bitnami/mariadb:10.3
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
      - MARIADB_SQL_MODE=STRICT_ALL_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
      - MARIADB_EXTRA_FLAGS=--local-infile=0 --max-allowed-packet=32M --innodb-buffer-pool-size=256MB
    volumes:
      - 'mariadb_data:/bitnami/mariadb'
  phabricator:
    image: catdb/phabricator:ssh
    # image: openserving/phabricator:latest
    ports:
      - '80:8080'
      - '443:8443'
      - '2222:2222'
    environment:
      - PHABRICATOR_USERNAME=catdb
      - PHABRICATOR_PASSWORD=qFuUys37
      - PHABRICATOR_EMAIL=phabricator@catdb.io
      - PHABRICATOR_FIRSTNAME=admin
      - PHABRICATOR_LASTNAME=admin
      - ALLOW_EMPTY_PASSWORD=yes
      - PHABRICATOR_HOST=192.168.50.2
    volumes:
      - 'phabricator_data:/bitnami/phabricator'
    privileged: true
    depends_on:
      - mariadb
volumes:
  mariadb_data:
    driver: local
  phabricator_data:
    driver: local
